<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæ•´åŠŸèƒ½æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-2xl font-bold mb-4">ğŸ¯ äº•å†ˆå±±éé—ç³»ç»Ÿéƒ¨ç½²æµ‹è¯•</h1>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <button onclick="testServer()"
                    class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600 transition">
                    ğŸ”— æµ‹è¯•æœåŠ¡å™¨è¿æ¥
                </button>

                <button onclick="testQuickChat()"
                    class="bg-green-500 text-white py-3 px-4 rounded hover:bg-green-600 transition">
                    ğŸ’¬ å¿«é€ŸèŠå¤©æµ‹è¯•
                </button>

                <button onclick="testFullChat()"
                    class="bg-purple-500 text-white py-3 px-4 rounded hover:bg-purple-600 transition">
                    ğŸ¤– å®Œæ•´å¯¹è¯æµ‹è¯•
                </button>

                <button onclick="clearLog()"
                    class="bg-gray-500 text-white py-3 px-4 rounded hover:bg-gray-600 transition">
                    ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—
                </button>
            </div>

            <div class="mb-4">
                <input type="text" id="customQuestion" placeholder="è¾“å…¥è‡ªå®šä¹‰é—®é¢˜æµ‹è¯•..."
                    class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                <button onclick="testCustom()"
                    class="mt-2 w-full bg-indigo-500 text-white py-2 px-4 rounded hover:bg-indigo-600 transition">
                    âœ¨ æµ‹è¯•è‡ªå®šä¹‰é—®é¢˜
                </button>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“‹ æµ‹è¯•æ—¥å¿—</h2>
            <div id="result" class="bg-gray-50 rounded p-4 min-h-[300px] font-mono text-sm overflow-y-auto max-h-96">
                ç­‰å¾…æµ‹è¯•å¼€å§‹...<br>
                <span class="text-blue-600">æç¤ºï¼šå¦‚æœé¦–æ¬¡è¿æ¥è¾ƒæ…¢ï¼Œæ˜¯å› ä¸ºå…è´¹æœåŠ¡å™¨éœ€è¦å¯åŠ¨æ—¶é—´ï¼ˆ30-60ç§’ï¼‰</span>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://websiteforjinggangshan.onrender.com';
        const result = document.getElementById('result');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-gray-700',
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600'
            };
            result.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
            result.scrollTop = result.scrollHeight;
        }

        function clearLog() {
            result.innerHTML = 'æ—¥å¿—å·²æ¸…ç©º<br>';
        }

        async function testServer() {
            try {
                log('ğŸ”„ æ­£åœ¨æµ‹è¯•æœåŠ¡å™¨è¿æ¥...', 'info');
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30ç§’è¶…æ—¶

                const response = await fetch(API_BASE + '/', {
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                const data = await response.text();
                log(`âœ… æœåŠ¡å™¨è¿æ¥æˆåŠŸï¼`, 'success');
                log(`ğŸ“„ å“åº”å†…å®¹: ${data}`, 'info');
                log(`ğŸŒ çŠ¶æ€ç : ${response.status}`, 'info');
            } catch (error) {
                if (error.name === 'AbortError') {
                    log('â° è¿æ¥è¶…æ—¶ï¼ˆ30ç§’ï¼‰- æœåŠ¡å™¨å¯èƒ½æ­£åœ¨å¯åŠ¨ä¸­ï¼Œè¯·ç¨åé‡è¯•', 'warning');
                } else {
                    log(`âŒ æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        async function testQuickChat() {
            try {
                log('ğŸ”„ æ­£åœ¨æµ‹è¯•èŠå¤©åŠŸèƒ½ï¼ˆç®€å•é—®é¢˜ï¼‰...', 'info');
                const response = await fetch(API_BASE + '/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: 'ä½ å¥½' })
                });

                const data = await response.json();
                if (data.answer) {
                    log('âœ… èŠå¤©åŠŸèƒ½æ­£å¸¸ï¼', 'success');
                    log(`ğŸ¤– AIå›ç­”: ${data.answer.substring(0, 100)}...`, 'info');
                } else {
                    log('âš ï¸ æ”¶åˆ°å“åº”ä½†æ— å›ç­”å†…å®¹', 'warning');
                    log(`ğŸ“„ å“åº”æ•°æ®: ${JSON.stringify(data)}`, 'info');
                }
            } catch (error) {
                log(`âŒ èŠå¤©åŠŸèƒ½å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function testFullChat() {
            try {
                log('ğŸ”„ æ­£åœ¨æµ‹è¯•å®Œæ•´å¯¹è¯ï¼ˆäº•å†ˆå±±é—®é¢˜ï¼‰...', 'info');
                const response = await fetch(API_BASE + '/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: 'è¯·ä»‹ç»ä¸€ä¸‹äº•å†ˆå±±çš„éç‰©è´¨æ–‡åŒ–é—äº§æœ‰å“ªäº›ï¼Ÿ'
                    })
                });

                const data = await response.json();
                if (data.answer) {
                    log('âœ… å®Œæ•´å¯¹è¯æµ‹è¯•æˆåŠŸï¼', 'success');
                    log(`ğŸ¯ ä¸“ä¸šå›ç­”: ${data.answer}`, 'info');
                } else {
                    log('âš ï¸ æ”¶åˆ°å“åº”ä½†æ— å›ç­”å†…å®¹', 'warning');
                }
            } catch (error) {
                log(`âŒ å®Œæ•´å¯¹è¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testCustom() {
            const question = document.getElementById('customQuestion').value.trim();
            if (!question) {
                log('âš ï¸ è¯·è¾“å…¥é—®é¢˜', 'warning');
                return;
            }

            try {
                log(`ğŸ”„ æ­£åœ¨æµ‹è¯•è‡ªå®šä¹‰é—®é¢˜: "${question}"`, 'info');
                const response = await fetch(API_BASE + '/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question })
                });

                const data = await response.json();
                if (data.answer) {
                    log('âœ… è‡ªå®šä¹‰é—®é¢˜æµ‹è¯•æˆåŠŸï¼', 'success');
                    log(`ğŸ’­ å›ç­”: ${data.answer}`, 'info');
                } else {
                    log('âš ï¸ æ”¶åˆ°å“åº”ä½†æ— å›ç­”å†…å®¹', 'warning');
                }
            } catch (error) {
                log(`âŒ è‡ªå®šä¹‰é—®é¢˜æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•è¿æ¥
        window.onload = function () {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå»ºè®®å…ˆç‚¹å‡»"æµ‹è¯•æœåŠ¡å™¨è¿æ¥"', 'info');
        };
    </script>
</body>

</html>